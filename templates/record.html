{% extends "base.html" %}

{% block title %}æ„Ÿæƒ…ã‚’è¨˜éŒ² - ã‚¨ãƒ¢ã‚¤ãƒ­{% endblock %}

{% block content %}
<div class="container">
    <section class="record-section">
        <h2>ä»Šæ—¥ã®æ„Ÿæƒ…ã‚’è¨˜éŒ²ã—ã¾ã—ã‚‡ã†</h2>
        <p>ã‚ãªãŸã®å¿ƒã®è‰²ã‚’é¸ã‚“ã§ãã ã•ã„</p>

        <form method="POST" class="record-form">
            <div class="form-group">
                <label for="date">æ—¥ä»˜</label>
                <input type="date" id="date" name="date" value="{{ today }}" max="{{ today }}" required>
            </div>

            <div class="form-group">
                <label>æ„Ÿæƒ…ã‚’é¸æŠã—ã¦ãã ã•ã„</label>
                <div class="emotion-grid">
                    {% for key, emotion in emotions.items() %}
                    <div class="emotion-option">
                        <input type="radio" 
                               id="emotion_{{ key }}" 
                               name="emotion_type" 
                               value="{{ key }}"
                               {% if existing_entry and existing_entry.emotion_type == key %}checked{% endif %}
                               required>
                        <label for="emotion_{{ key }}" 
                               class="emotion-label"
                               style="background-color: {{ emotion.color }}20; border: 2px solid {{ emotion.color }}">
                            <span class="emotion-emoji">{{ emotion.icon }}</span>
                            <span class="emotion-name">{{ emotion.name }}</span>
                        </label>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <div class="form-group">
                <label for="note">ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰</label>
                <textarea id="note" 
                         name="note" 
                         placeholder="ä»Šæ—¥ã®å‡ºæ¥äº‹ã‚„æ„Ÿã˜ãŸã“ã¨ã‚’è‡ªç”±ã«æ›¸ã„ã¦ãã ã•ã„..."
                         rows="4">{% if existing_entry %}{{ existing_entry.note }}{% endif %}</textarea>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary btn-large">
                    {% if existing_entry %}è¨˜éŒ²ã‚’æ›´æ–°ã™ã‚‹{% else %}è¨˜éŒ²ã™ã‚‹{% endif %}
                </button>
                <a href="{{ url_for('index') }}" class="btn btn-secondary">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</a>
            </div>
        </form>
    </section>

    <section class="motivation-section">
        <div class="motivation-card">
            <h3>ğŸ’¡ è¨˜éŒ²ã®ã‚³ãƒ„</h3>
            <ul>
                <li>ãã®ç¬é–“ã®æ°—æŒã¡ã‚’ç´ ç›´ã«è¨˜éŒ²ã—ã¾ã—ã‚‡ã†</li>
                <li>å°ã•ãªæ„Ÿæƒ…ã®å¤‰åŒ–ã‚‚å¤§åˆ‡ã§ã™</li>
                <li>ãƒ¡ãƒ¢ã«ã¯å…·ä½“çš„ãªå‡ºæ¥äº‹ã‚’æ›¸ãã¨æŒ¯ã‚Šè¿”ã‚Šã«å½¹ç«‹ã¡ã¾ã™</li>
            </ul>
        </div>
    </section>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const emotionOptions = document.querySelectorAll('.emotion-option');
    const form = document.querySelector('.record-form');
    
    // Add interactive effects to emotion selection
    emotionOptions.forEach(option => {
        const input = option.querySelector('input[type="radio"]');
        const label = option.querySelector('.emotion-label');
        
        // Update visual state based on selection
        function updateSelection() {
            emotionOptions.forEach(opt => {
                opt.classList.remove('selected');
            });
            if (input.checked) {
                option.classList.add('selected');
            }
        }
        
        input.addEventListener('change', updateSelection);
        
        // Add hover effects
        label.addEventListener('mouseenter', function() {
            if (!input.checked) {
                this.style.transform = 'scale(1.05)';
            }
        });
        
        label.addEventListener('mouseleave', function() {
            if (!input.checked) {
                this.style.transform = 'scale(1)';
            }
        });
        
        // Initialize state
        updateSelection();
    });
    
    // Form submission animation and clear memo field
    form.addEventListener('submit', function(e) {
        const submitBtn = form.querySelector('button[type="submit"]');
        submitBtn.innerHTML = 'è¨˜éŒ²ä¸­... âœ¨';
        submitBtn.disabled = true;
        
        // Clear memo field after successful submission
        // Add a small delay to ensure form submission is processed
        setTimeout(() => {
            const noteField = document.querySelector('#note');
            if (noteField) {
                noteField.value = '';
                noteField.style.height = 'auto';
            }
        }, 100);
    });
    
    // Auto-resize textarea
    const textarea = document.querySelector('#note');
    textarea.addEventListener('input', function() {
        this.style.height = 'auto';
        this.style.height = this.scrollHeight + 'px';
    });
});
</script>
{% endblock %}